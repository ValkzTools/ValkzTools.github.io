<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Webcam Recorder</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body {
      min-height:100vh;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(135deg,#6a3fb5,#3b8cff);
      color:#fff;
      padding:20px 20px 40px 240px;
    }
    .sidebar {
      position: fixed;
      left:0;
      top:0;
      bottom:0;
      width:220px;
      background: rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      padding:25px 15px;
      display:flex;
      flex-direction:column;
      gap:20px;
      z-index:10;
      border-right:2px solid rgba(255,255,255,0.08);
    }
    .sidebar h2 { font-size:1.2rem; margin-bottom:5px; letter-spacing:1px; }
    .nav-link {
      text-decoration:none;
      color:#fff;
      padding:10px 12px;
      border-radius:8px;
      display:block;
      font-weight:600;
      transition: background .2s;
    }
    .nav-link:hover { background: rgba(255,255,255,0.08); }
    .nav-link.active { background: rgba(255,255,255,0.15); }
    h1 { text-align:center; margin-bottom:10px; }
    .panel {
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
      padding:10px;
    }
    .box {
      background: rgba(255,255,255,0.05);
      border-radius:12px;
      padding:15px;
      backdrop-filter: blur(6px);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    label { font-size:0.9rem; margin-top:5px; }
    select, button {
      padding:10px;
      border-radius:8px;
      border:none;
      font-family: inherit;
      font-size:1rem;
      outline:none;
      cursor:pointer;
    }
    video {
      width:100%;
      border-radius:12px;
      background:#000;
    }
    .controls {
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .status {
      margin-top:8px;
      font-size:0.85rem;
    }
    a.download-link {
      display:inline-block;
      margin-top:10px;
      background:#ffe600;
      color:#000;
      padding:10px 18px;
      border-radius:10px;
      text-decoration:none;
      font-weight:700;
    }
    .note {
      font-size:0.75rem;
      opacity:0.9;
      margin-top:6px;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Valkz Tools</h2>
    <a class="nav-link" href="index.html">Login</a>
    <a class="nav-link active" href="Webcam.html">Webcam</a>
    <a class="nav-link" href="Voice Recorder.html">Voice Recorder</a>
    <a class="nav-link" href="Discord.html">Discord</a>
    <a class="nav-link" href="Robloxc.html">Robloxc</a>
  </div>

  <div style="padding-top:10px;">
    <h1>Webcam Recorder</h1>
    <div class="panel">
      <div class="box">
        <div>
          <label for="videoSource">Camera:</label>
          <select id="videoSource"></select>
        </div>
        <div>
          <label for="audioSource">Microphone:</label>
          <select id="audioSource"></select>
        </div>
        <div class="controls">
          <button id="startBtn">Start Preview</button>
          <button id="startRec">Start Recording</button>
          <button id="stopRec" disabled>Stop Recording</button>
        </div>
        <div class="status" id="status">Idle.</div>
        <div class="note">Desktop audio may only be available when you grant screen sharing with audio; some OS/browser combos restrict system audio capture.</div>
        <div>
          <label><input type="checkbox" id="includeDesktop" /> Include Desktop Audio (screen capture)</label>
        </div>
        <div id="downloadContainer"></div>
      </div>
      <div class="box">
        <video id="preview" autoplay muted playsinline></video>
        <div class="status" id="resolutionInfo">Resolution & FPS info will appear here.</div>
      </div>
    </div>
  </div>

  <script>
    let currentStream = null;
    let recorder = null;
    let recordedChunks = [];
    let mixedStream = null;

    const videoSelect = document.getElementById("videoSource");
    const audioSelect = document.getElementById("audioSource");
    const preview = document.getElementById("preview");
    const startBtn = document.getElementById("startBtn");
    const startRec = document.getElementById("startRec");
    const stopRec = document.getElementById("stopRec");
    const statusEl = document.getElementById("status");
    const resolutionInfo = document.getElementById("resolutionInfo");
    const downloadContainer = document.getElementById("downloadContainer");
    const includeDesktopCheckbox = document.getElementById("includeDesktop");

    async function populateDevices(){
      const devices = await navigator.mediaDevices.enumerateDevices();
      videoSelect.innerHTML="";
      audioSelect.innerHTML="";
      devices.forEach(d=>{
        const option = document.createElement("option");
        option.value = d.deviceId;
        if(d.kind === "videoinput"){
          option.text = d.label || `Camera ${videoSelect.length+1}`;
          videoSelect.appendChild(option);
        } else if(d.kind === "audioinput"){
          option.text = d.label || `Mic ${audioSelect.length+1}`;
          audioSelect.appendChild(option);
        }
      });
    }

    async function startPreview(){
      if(currentStream){
        currentStream.getTracks().forEach(t=>t.stop());
      }
      const videoId = videoSelect.value;
      try {
        const constraints = {
          video: {
            deviceId: videoId ? { exact:videoId } : undefined,
            width: { ideal:1920 },
            height: { idea
